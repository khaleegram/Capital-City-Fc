rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper functions
    function isSignedIn() {
      return request.auth != null;
    }

    // A simple check for an "admin". For this app, any signed-in user is an admin.
    function isAdmin() {
      return isSignedIn();
    }

    // Players: Public read, admin write
    match /players/{playerId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // News: Public read, admin write
    match /news/{articleId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Videos: Public read, admin write
    match /videos/{videoId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Fixtures & Live Events: Public read, admin write
    match /fixtures/{fixtureId} {
      allow read: if true;
      allow write: if isAdmin();

      match /liveEvents/{eventId} {
        allow read: if true;
        allow write: if isAdmin();
      }
    }

    // Recaps: Public read, admin write
    match /recaps/{recapId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Team Profile: Public read, admin write
    match /teamProfile/{profileId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Formations: Admin read/write
    match /formations/{formationId} {
      // Only admins should see saved formations
      allow read, write: if isAdmin();
    }

    // Player Videos (Junction table): Admin read/write
    match /playerVideos/{tagId} {
       // Only admins should see these relationships
      allow read, write: if isAdmin();
    }

    // User Push Tokens: Only the owner can read/write their own token
    match /userPushTokens/{userId} {
      allow read, write: if isSignedIn() && request.auth.uid == userId;
    }
  }
}
